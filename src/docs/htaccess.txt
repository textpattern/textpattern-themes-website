<IfModule mod_headers.c>
    # HSTS.

    Header set Strict-Transport-Security "max-age=16070400"

    # Content Security Policy.

    Header unset P3P
    Header always set X-XSS-Protection "1; mode=block"
    Header always set X-Frame-Options "DENY"
    Header always set X-Content-Type-Options "nosniff"
    Header set Content-Security-Policy "default-src 'self'; font-src textpattern.io https://textpattern.io; img-src 'self' data: * https://*; media-src 'self' * https://*; style-src 'self' 'unsafe-inline' textpattern.io https://textpattern.io; script-src 'self' 'sha256-YYScNyq3RC/7G7GRTG1R3s34wQFeFysoFR64eLJ0lsQ=' textpattern.io https://textpattern.io; connect-src 'self' api.github.com https://api.github.com"

    # Expect-CT (TODO: currently in testing).

    Header set Expect-CT "max-age=0; report-uri=https://themes.textpattern.io/expect-ct-report"

    Header unset ETag
</ifModule>

FileETag None

<IfModule mod_rewrite.c>
    RewriteEngine On

    # No 'www'.

    RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
    RewriteRule ^(.*)$ http://%1/$1 [R=301,L]

    # Redirect from `http://` to `https://` protocol.

    RewriteCond %{HTTPS} !=on
    RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

    # Textpattern.

    RewriteCond %{REQUEST_FILENAME} -f [OR]
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^(.+) - [PT,L]

    RewriteRule ^(.*) index.php

    RewriteCond %{HTTP:Authorization}  !^$
    RewriteRule .* - [E=REMOTE_USER:%{HTTP:Authorization}]
</IfModule>

Options -Indexes

AddDefaultCharset utf-8

<IfModule mod_mime.c>
    AddCharset utf-8 .atom \
                     .css \
                     .js \
                     .json \
                     .jsonld \
                     .manifest \
                     .rdf \
                     .rss \
                     .xml
</IfModule>

<IfModule mod_mime.c>
    # Data interchange.

    AddType application/ld+json    jsonld

    # Media files.

    AddType image/webp             webp
    AddType video/mp4              f4v f4p m4v mp4
    AddType video/webm             webm

    # Web fonts.

    AddType application/font-woff  woff
    AddType application/font-woff2 woff2
</IfModule>

<IfModule mod_expires.c>
    ExpiresActive on
    ExpiresDefault                                    "access plus 1 month"

    # CSS.

    ExpiresByType text/css                            "access plus 1 month"

    # Data interchange.

    ExpiresByType application/atom+xml                "access plus 1 hour"
    ExpiresByType application/rdf+xml                 "access plus 1 hour"
    ExpiresByType application/rss+xml                 "access plus 1 hour"
    ExpiresByType application/json                    "access plus 0 seconds"
    ExpiresByType application/ld+json                 "access plus 0 seconds"
    ExpiresByType application/schema+json             "access plus 0 seconds"
    ExpiresByType application/xml                     "access plus 0 seconds"
    ExpiresByType text/xml                            "access plus 0 seconds"

    # Favicon and cursor images.

    ExpiresByType image/vnd.microsoft.icon            "access plus 1 month"
    ExpiresByType image/x-icon                        "access plus 1 month"

    # HTML.

    ExpiresByType text/html                           "access plus 0 seconds"

    # JavaScript.

    ExpiresByType application/javascript              "access plus 1 month"
    ExpiresByType application/x-javascript            "access plus 1 month"
    ExpiresByType text/javascript                     "access plus 1 month"

    # Manifest files.

    ExpiresByType application/manifest+json           "access plus 1 week"
    ExpiresByType text/cache-manifest                 "access plus 0 seconds"

    # Media files.

    ExpiresByType image/gif                           "access plus 1 month"
    ExpiresByType image/jpeg                          "access plus 1 month"
    ExpiresByType image/png                           "access plus 1 month"
    ExpiresByType image/svg+xml                       "access plus 1 month"
    ExpiresByType image/webp                          "access plus 1 month"
    ExpiresByType video/mp4                           "access plus 1 month"
    ExpiresByType video/webm                          "access plus 1 month"

    # Web fonts.

    # Web Open Font Format (WOFF)
    ExpiresByType application/font-woff               "access plus 1 month"
    ExpiresByType application/x-font-woff             "access plus 1 month"
    ExpiresByType font/woff                           "access plus 1 month"
    ExpiresByType application/font-woff2              "access plus 1 month"

    # Other.

    ExpiresByType text/x-cross-domain-policy          "access plus 1 week"
</IfModule>
